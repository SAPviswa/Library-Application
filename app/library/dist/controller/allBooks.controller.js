sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/m/MessageBox"],function(e,t,o){"use strict";return e.extend("com.app.library.controller.allBooks",{onInit:function(){const e=this.getOwnerComponent().getRouter();e.attachRoutePatternMatched(this.onUserDetailsLoad,this)},onUserDetailsLoad:function(e){const{id:t}=e.getParameter("arguments");this.ID=t;const o=this.getView().byId("idUserPage");o.bindElement(`/Users(${t})`)},setHeaderContext:function(){var e=this.getView();e.byId("Bookstitle").setBindingContext(e.byId("_IDGenTable1").getBinding("items").getHeaderContext())},onSearch:function(e){var t=e.getParameter("query");var o=[];if(t){o.push(new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("title",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("author",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("genre",sap.ui.model.FilterOperator.Contains,t)],and:false}))}var i=this.byId("idAllBookTable");var s=i.getBinding("items");s.filter(o)},onReservePress:function(e){var t=e.getSource();var i=this.ID;if(this.byId("idAllBookTable").getSelectedItems().length>1){MessageToast.show("Please Select only one Book");return}var s=this.byId("idAllBookTable").getSelectedItem().getBindingContext().getObject();var n=s.availability-1;var a=s.title;o.confirm(`Do you want to reserve the book "${a}"?`,{actions:[o.Action.YES,o.Action.CANCEL],onClose:async function(e){if(e===o.Action.OK){const e=new sap.ui.model.json.JSONModel({user_ID:i,book_ID:s.ID,reservedDate:new Date,book:{availability:n}});this.getView().setModel(e,"userModel");const t=this.getView().getModel("userModel").getProperty("/"),o=this.getView().getModel("ModelV2");try{await this.createData(o,t,"/IssueBooks")}catch(e){sap.m.MessageBox.error("Some technical issue occurred.")}}}.bind(this)})}})});