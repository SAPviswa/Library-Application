sap.ui.define(["./BaseController","sap/m/MessageToast","sap/ui/model/odata/v2/ODataModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel"],function(e,s,a,t,i,o){"use strict";return e.extend("com.app.library.controller.HomePage",{onInit:function(){var e=new a("/v2/BooksSrv/");this.getView().setModel(e);const s=new o({userName:"",password:"",email:"",phoneNumber:"",Address:"",userType:"user"});this.getView().setModel(s,"localModel")},onPressLogin:async function(){if(!this.loginDialog){this.loginDialog=await this.loadFragment("authenticate")}this.loginDialog.open()},oncancelbtn:function(){if(this.loginDialog.isOpen()){this.loginDialog.close()}},loginBtnClick:function(){var e=this.getView();var a=e.byId("user").getValue();var o=e.byId("pswd").getValue();if(!a||!o){s.show("please enter username and password.");return}var n=this.getView().getModel();n.read("/Users",{filters:[new t("email",i.EQ,a),new t("password",i.EQ,o)],success:function(e){if(e.results.length>0){var a=e.results[0].ID;var t=e.results[0].userType;s.show("Login Successful");if(t==="user"){var i=this.getOwnerComponent().getRouter();i.navTo("RouteUserPage",{id:a})}else{var i=this.getOwnerComponent().getRouter();i.navTo("RouteAdminPage",{id:a})}}else{s.show("Invalid username or password.")}}.bind(this),error:function(){s.show("An error occured during login.")}})},onBtnSignup:async function(){if(!this.signupDialog){this.signupDialog=await this.loadFragment("signup")}this.signupDialog.open()},onsignupcancelbtn:function(){if(this.signupDialog.isOpen()){this.signupDialog.close()}},onClearFilterPress:function(){this.byId("user").setValue("");this.byId("pswd").setValue("")},AvailableBooksBtn:async function(){if(!this.libraryinfo){this.libraryinfo=await this.loadFragment("libraryinfo")}this.libraryinfo.open()},signupBtnClick:async function(){debugger;const e=this.getView().getModel("localModel").getProperty("/"),a=this.getView().getModel("ModelV2");var t=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;var i=/^(?:(?:\+|0{0,2})91(\s*[\-]\s*)?|[0]?)?[789]\d{9}$/;if(!(t.test(e.email)&&i.test(e.phoneNumber))){s.show("please enter valid Email and PhoneNumber");return}try{await this.createData(a,e,"/Users");this.signupDialog.close();s.show("SignUp Successful")}catch(e){s.show("User already exists.please enter the valid details")}},onEmailLiveChange:async function(e){var s=e.getSource();var a=s.getValue();var t=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(a.trim()===""){s.setValueState("None")}else if(a.match(t)){s.setValueState("Success")}else{s.setValueState("Error");if(sap.m.MessageToast){sap.m.MessageToast.show("Invalid Email format")}else{console.error("MessageToast is not available.")}}},onMobileVal:async function(e){var s=e.getSource();var a=s.getValue();var t=/^[0-9]{10}$/;if(a.trim()===""){s.setValueState("None")}else if(a.match(t)){s.setValueState("Success")}else{s.setValueState("Error");if(sap.m.MessageToast){sap.m.MessageToast.show("Invalid Phone format")}else{}}},clearInputs:function(){var e=this.getView();e.byId("user1").setValue("");e.byId("password1").setValue("");e.byId("email").setValue("");e.byId("phoneNumber").setValue("");e.byId("Address").setValue("")}})});